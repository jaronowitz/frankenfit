[tox]
envlist =
    black
    flake8
    # py311  # waiting for pyarrow to release a wheel
    py310
    py39
    py38
    # docs

isolated_build = true

[testenv]
description = Run tests and type checker (config in pyproject.toml)
extras =
    tests
passenv =
    CURL_CA_BUNDLE
    PIP_CACHE_DIR
    PYTEST_*
    REQUESTS_CA_BUNDLE
    SSL_CERT_FILE
commands =
    pytest
    dmypy run

[testenv:docs]
extras =
    docs
commands =
    # Ordinarily we might do the following:
    #   jupyter-book build docs/
    # But that fails to respect the pygments_dark_style config, so we must manually
    # chain together config generation with sphinx build.
    jupyter-book config sphinx docs/
    sphinx-build -b html docs/ docs/_build/html

[testenv:flake8]
description = Check codebase with flake8 linter (config in pyproject.toml)
deps =
    flake8
    flake8-pyproject
skip_install = true
commands =
    flake8 src tests

[testenv:black]
description = Check codebase for black style (config in pyproject.toml)
deps =
    black
skip_install = true
commands =
    black --check --diff --color src tests
