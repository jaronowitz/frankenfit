<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Transforms and pipelines" href="transforms_and_pipelines.html" /><link rel="prev" title="Installation and getting started" href="install.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.09.29"/>
        <title>Synopsis and overview - ðŸ§Ÿ Frankenfit Documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="_static/pygments_overrides.css" />
    <link rel="stylesheet" type="text/css" href="_static/pygments_overrides.css" />
    <link rel="stylesheet" type="text/css" href="_static/pygments_overrides.css" />
    
    


<style>
  body {
    --color-code-background: #282a36;
  --color-code-foreground: #f8f8f2;
  --color-background-item: #6272A4;
  --color-brand-primary: #50FA7B;
  --color-brand-content: #50FA7B;
  --color-problematic: #FF5555;
  --color-foreground-primary: #F8F8F2;
  --color-foreground-secondary: #6272A4;
  --color-foreground-border: #6272A4;
  --color-background-primary: #282A36;
  --color-background-secondary: #343746;
  --color-background-hover: #44475A;
  --color-background-hover--transparent: #44475A;
  --color-highlighted-background: #44475A75;
  --color-admonition-background: #343746;
  --color-admonition-title--caution: #FFB86C;
  --color-admonition-title-background--caution: rgba(255, 184, 108, .1);
  --color-admonition-title--warning: #F1FA8C;
  --color-admonition-title-background--warning: rgba(241, 250, 140, .1);
  --color-admonition-title--danger: #FF5555;
  --color-admonition-title-background--danger: rgba(255, 85, 85, .1);
  --color-admonition-title--attention: #FF5555;
  --color-admonition-title-background--attention: rgba(255, 85, 85, .1);
  --color-admonition-title--error: #FF5555;
  --color-admonition-title-background--error: rgba(255, 85, 85, .1);
  --color-admonition-title--hint: #50FA7B;
  --color-admonition-title-background--hint: rgba(80, 250, 123, .1);
  --color-admonition-title--tip: #50FA7B;
  --color-admonition-title-background--tip: rgba(80, 250, 123, .1);
  --color-admonition-title--important: #FF79C6;
  --color-admonition-title-background--important: rgba(255, 121, 198, .1);
  --color-admonition-title--note: #BD93F9;
  --color-admonition-title-background--note: rgba(189, 147, 249, .1);
  --color-admonition-title--seealso: #6272A4;
  --color-admonition-title-background--seealso: rgba(98, 114, 164, .1);
  --color-admonition-title--admonition-todo: #808080;
  --color-admonition-title-background--admonition-todo: rgba(128, 128, 128, .1);
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #282a36;
  --color-code-foreground: #f8f8f2;
  --color-background-item: #6272A4;
  --color-brand-primary: #50FA7B;
  --color-brand-content: #50FA7B;
  --color-problematic: #FF5555;
  --color-foreground-primary: #F8F8F2;
  --color-foreground-secondary: #6272A4;
  --color-foreground-border: #6272A4;
  --color-background-primary: #282A36;
  --color-background-secondary: #343746;
  --color-background-hover: #44475A;
  --color-background-hover--transparent: #44475A;
  --color-highlighted-background: #44475A75;
  --color-admonition-background: #343746;
  --color-admonition-title--caution: #FFB86C;
  --color-admonition-title-background--caution: rgba(255, 184, 108, .1);
  --color-admonition-title--warning: #F1FA8C;
  --color-admonition-title-background--warning: rgba(241, 250, 140, .1);
  --color-admonition-title--danger: #FF5555;
  --color-admonition-title-background--danger: rgba(255, 85, 85, .1);
  --color-admonition-title--attention: #FF5555;
  --color-admonition-title-background--attention: rgba(255, 85, 85, .1);
  --color-admonition-title--error: #FF5555;
  --color-admonition-title-background--error: rgba(255, 85, 85, .1);
  --color-admonition-title--hint: #50FA7B;
  --color-admonition-title-background--hint: rgba(80, 250, 123, .1);
  --color-admonition-title--tip: #50FA7B;
  --color-admonition-title-background--tip: rgba(80, 250, 123, .1);
  --color-admonition-title--important: #FF79C6;
  --color-admonition-title-background--important: rgba(255, 121, 198, .1);
  --color-admonition-title--note: #BD93F9;
  --color-admonition-title-background--note: rgba(189, 147, 249, .1);
  --color-admonition-title--seealso: #6272A4;
  --color-admonition-title-background--seealso: rgba(98, 114, 164, .1);
  --color-admonition-title--admonition-todo: #808080;
  --color-admonition-title-background--admonition-todo: rgba(128, 128, 128, .1);
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #282a36;
  --color-code-foreground: #f8f8f2;
  --color-background-item: #6272A4;
  --color-brand-primary: #50FA7B;
  --color-brand-content: #50FA7B;
  --color-problematic: #FF5555;
  --color-foreground-primary: #F8F8F2;
  --color-foreground-secondary: #6272A4;
  --color-foreground-border: #6272A4;
  --color-background-primary: #282A36;
  --color-background-secondary: #343746;
  --color-background-hover: #44475A;
  --color-background-hover--transparent: #44475A;
  --color-highlighted-background: #44475A75;
  --color-admonition-background: #343746;
  --color-admonition-title--caution: #FFB86C;
  --color-admonition-title-background--caution: rgba(255, 184, 108, .1);
  --color-admonition-title--warning: #F1FA8C;
  --color-admonition-title-background--warning: rgba(241, 250, 140, .1);
  --color-admonition-title--danger: #FF5555;
  --color-admonition-title-background--danger: rgba(255, 85, 85, .1);
  --color-admonition-title--attention: #FF5555;
  --color-admonition-title-background--attention: rgba(255, 85, 85, .1);
  --color-admonition-title--error: #FF5555;
  --color-admonition-title-background--error: rgba(255, 85, 85, .1);
  --color-admonition-title--hint: #50FA7B;
  --color-admonition-title-background--hint: rgba(80, 250, 123, .1);
  --color-admonition-title--tip: #50FA7B;
  --color-admonition-title-background--tip: rgba(80, 250, 123, .1);
  --color-admonition-title--important: #FF79C6;
  --color-admonition-title-background--important: rgba(255, 121, 198, .1);
  --color-admonition-title--note: #BD93F9;
  --color-admonition-title-background--note: rgba(189, 147, 249, .1);
  --color-admonition-title--seealso: #6272A4;
  --color-admonition-title-background--seealso: rgba(98, 114, 164, .1);
  --color-admonition-title--admonition-todo: #808080;
  --color-admonition-title-background--admonition-todo: rgba(128, 128, 128, .1);
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="cover.html"><div class="brand">ðŸ§Ÿ Frankenfit Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="cover.html">
  
  
  <span class="sidebar-brand-text">ðŸ§Ÿ Frankenfit Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation and getting started</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Synopsis and overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="transforms_and_pipelines.html">Transforms and pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="hyperparams.html">Hyperparameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataframes.html">Working with DataFrames and <code class="docutils literal notranslate"><span class="pre">DataFramePipelines</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="branching_and_grouping.html">Branching and grouping transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="backends.html">Backends and parallel compute</a></li>
<li class="toctree-l1"><a class="reference internal" href="implementing_transforms.html">Implementing your own transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="crossval.html">Cross-validation and hyperparameter search</a></li>
<li class="toctree-l1"><a class="reference internal" href="tips_tricks.html">Tips and tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Frankenfit API reference</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="synopsis-and-overview">
<h1>Synopsis and overview<a class="headerlink" href="#synopsis-and-overview" title="Permalink to this headline">#</a></h1>
<p>Frankenfit is a Python library for data scientists that provides a domain-specific
language (DSL) for creating, fitting, and applying predictive data modeling pipelines.
Its key features are:</p>
<ul class="simple">
<li><p>A concise and readable <strong>DSL</strong> (inspired by the pandas <a class="reference external" href="https://tomaugspurger.github.io/posts/method-chaining/">method-chaining
style</a>) to create data
modeling <strong>pipelines</strong> from chains of composable building blocks called
<strong>transforms</strong>. Pipelines themselves are composable, re-usable, and extensible, with
a thorough <a class="reference internal" href="api.html#transform-library"><span class="std std-ref">library of transforms</span></a> available for building,
grouping, and combining pipelines in useful ways.</p></li>
<li><p>Rigorous separation between, on the one hand, <strong>fitting</strong> the state of your pipeline
on some training data, and, on the other, <strong>applying</strong> it
<a class="reference external" href="https://stats.stackexchange.com/questions/260899/what-is-difference-between-in-sample-and-out-of-sample-forecasts">out-of-sample</a>
to make predictions on test data. Once fit, a pipeline can be re-used to make
predictions on many different test datasets, and these predictions are truly
<strong>out-of-sample</strong>, right down to the quantiles used to winsorize your features
(for example).</p></li>
<li><p>The ability to specify your pipelineâ€™s parameters as <strong>hyperparameters</strong>, whose values
are bound later. This can make your pipelines more re-usable, and enables powerful
workflows like hyperparameter search, cross-validation, and other resampling schemes,
all described in the same DSL used to create pipelines.</p></li>
<li><p><strong>Parallel computation</strong> on distributed backends (currently
<a class="reference external" href="https://www.dask.org">Dask</a>). Frankenfit automatically figures out which parts of your
pipeline are independent of each other and runs them in parallel on a distributed
compute cluster.</p></li>
<li><p>A focus on <strong>user ergonomics</strong> and <strong>interactive usage.</strong> Extensive type annotations
enable smart auto-completions by IDEs. <a class="reference internal" href="transforms_and_pipelines.html#visualizing-pipelines"><span class="std std-ref">Visualizations</span></a> help
you see what your pipelines are doing. You can <a class="reference internal" href="implementing_transforms.html#implementing-transforms"><span class="std std-ref">implement your own
transforms</span></a> with almost zero boilerplate.</p></li>
</ul>
<p>Frankenfit takes some inspiration from scikit-learnâ€™s <a class="reference external" href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.pipeline"><code class="docutils literal notranslate"><span class="pre">pipeline</span></code>
module</a>,
but aims to be much more general-purpose and flexible. It integrates easily with
industry-standard libraries like <a class="reference external" href="https://pandas.pydata.org">pandas</a>,
<a class="reference external" href="https://scikit-learn.org">scikit-learn</a> and <a class="reference external" href="https://www.statsmodels.org">statsmodels</a>,
or your own in-house library of statistical models and data transformations.</p>
<p>Frankenfitâ€™s focus is on 2-D Pandas DataFrames, but the core API is agnostic and could also
be used to implement pipelines on other data types, like text or images.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>As a stylistic convention, and for the sake of brevity, the author of Frankenfit
recommends importing <code class="docutils literal notranslate"><span class="pre">frankenfit</span></code> with the short name <code class="docutils literal notranslate"><span class="pre">ff</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">frankenfit</span> <span class="k">as</span> <span class="nn">ff</span>
</pre></div>
</div>
</div>
<p>With Frankenfit, you can:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#synopsis-create"><span class="std std-ref">Create pipelines</span></a> using a DSL of call-chain methods.</p></li>
<li><p><a class="reference internal" href="#synopsis-fit-apply"><span class="std std-ref">Fit pipelines and apply them to data</span></a> to generate predictions.</p></li>
<li><p><a class="reference internal" href="#synopsis-hyperparams"><span class="std std-ref">Use hyperparameters</span></a> to generalize your pipelines and concisely
execute hyperparameter searches and data batching.</p></li>
<li><p><a class="reference internal" href="#synopsis-backends"><span class="std std-ref">Run your pipelines on distributed backends</span></a>, exploiting the
parallelism inherent to any branching operations in a pipeline.</p></li>
</ul>
<p>The remainder of this page summarizes each of these workflows with a running example,
while the subsequent sections of the documentation detail how everything works from the
ground up.</p>
<section id="create-pipelines">
<span id="synopsis-create"></span><h2>Create pipelines<a class="headerlink" href="#create-pipelines" title="Permalink to this headline">#</a></h2>
<p>Letâ€™s suppose we want to model the prices of round-cut diamonds using the venerable
<a class="reference external" href="https://ggplot2.tidyverse.org/reference/diamonds.html">diamonds</a> dataset, which is
often used to teach regression, and looks like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydataset</span> <span class="kn">import</span> <span class="n">data</span>
<span class="n">diamonds_df</span> <span class="o">=</span> <span class="n">data</span><span class="p">(</span><span class="s1">&#39;diamonds&#39;</span><span class="p">)</span>
<span class="n">diamonds_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">diamonds_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>initiated datasets repo at: /home/runner/.pydataset/
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 53940 entries, 1 to 53940
Data columns (total 10 columns):
 #   Column   Non-Null Count  Dtype  
---  ------   --------------  -----  
 0   carat    53940 non-null  float64
 1   cut      53940 non-null  object 
 2   color    53940 non-null  object 
 3   clarity  53940 non-null  object 
 4   depth    53940 non-null  float64
 5   table    53940 non-null  float64
 6   price    53940 non-null  int64  
 7   x        53940 non-null  float64
 8   y        53940 non-null  float64
 9   z        53940 non-null  float64
dtypes: float64(6), int64(1), object(3)
memory usage: 4.5+ MB
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.23</td>
      <td>Ideal</td>
      <td>E</td>
      <td>SI2</td>
      <td>61.5</td>
      <td>55.0</td>
      <td>326</td>
      <td>3.95</td>
      <td>3.98</td>
      <td>2.43</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.21</td>
      <td>Premium</td>
      <td>E</td>
      <td>SI1</td>
      <td>59.8</td>
      <td>61.0</td>
      <td>326</td>
      <td>3.89</td>
      <td>3.84</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.23</td>
      <td>Good</td>
      <td>E</td>
      <td>VS1</td>
      <td>56.9</td>
      <td>65.0</td>
      <td>327</td>
      <td>4.05</td>
      <td>4.07</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.29</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS2</td>
      <td>62.4</td>
      <td>58.0</td>
      <td>334</td>
      <td>4.20</td>
      <td>4.23</td>
      <td>2.63</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.31</td>
      <td>Good</td>
      <td>J</td>
      <td>SI2</td>
      <td>63.3</td>
      <td>58.0</td>
      <td>335</td>
      <td>4.34</td>
      <td>4.35</td>
      <td>2.75</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Throughout the documentation we make use of the
<a class="reference external" href="https://pypi.org/project/pydataset/">pydataset</a> package for loading example data like
<code class="docutils literal notranslate"><span class="pre">diamonds</span></code>.</p>
<p>Also, as a fellow <em>bourgeois</em> of the Western world, the author of Frankenfit assumes
that you know what these variables mean in the context of diamonds.</p>
</div>
<p>Letâ€™s divide the data into random training and test sets, and examine the distributions
of the <code class="docutils literal notranslate"><span class="pre">carat</span></code>, <code class="docutils literal notranslate"><span class="pre">depth</span></code>, <code class="docutils literal notranslate"><span class="pre">table</span></code>, and <code class="docutils literal notranslate"><span class="pre">price</span></code> variables on the training set:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># randomly split train and test data</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">diamonds_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1337_420_69</span><span class="p">)</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">diamonds_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">diamonds_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>

<span class="p">(</span>
    <span class="n">train_df</span>
    <span class="p">[[</span><span class="s2">&quot;carat&quot;</span><span class="p">,</span> <span class="s2">&quot;depth&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">hist</span><span class="p">()</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/synopsis_6_0.png" src="_images/synopsis_6_0.png" />
</div>
</div>
<p>Below is our predictive pipeline for modeling <code class="docutils literal notranslate"><span class="pre">price</span></code>. The core of it is a linear
regression of <code class="docutils literal notranslate"><span class="pre">price</span></code> on <code class="docutils literal notranslate"><span class="pre">carat</span></code>, <code class="docutils literal notranslate"><span class="pre">table</span></code>, and <code class="docutils literal notranslate"><span class="pre">depth</span></code> (using the scikit-learn
<code class="docutils literal notranslate"><span class="pre">LinearRegression</span></code> estimator), but first, inspired by the histograms above, our pipeline
creates a training response <code class="docutils literal notranslate"><span class="pre">price_train</span></code> by log-transforming and winsorizing the raw
<code class="docutils literal notranslate"><span class="pre">price</span></code>, and creates features by winsorizing, z-scoring, and clipping the raw predictor
variables (and in the case of <code class="docutils literal notranslate"><span class="pre">carat</span></code>, log-transforming it). Finally we exponeniate the
predictions of the regression to put them in the original units of <code class="docutils literal notranslate"><span class="pre">price</span></code> (dollars).</p>
<p>The pipeline is created by a chained sequence of method calls on a
<a class="reference internal" href="api.html#frankenfit.DataFramePipeline" title="frankenfit.DataFramePipeline"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">DataFramePipeline</span></code></span></a> object, some of which accept
arguments that are themselves <code class="docutils literal notranslate"><span class="pre">DataFramePipelines</span></code> built up by their own call-chains. We
call this the <a class="reference internal" href="transforms_and_pipelines.html#call-chain-api"><span class="std std-ref"><strong>call-chain API</strong></span></a>. Each method call adds a
<strong>transform</strong> to the pipeline, and you can peruse the library of built-in transforms <a class="reference internal" href="api.html#transform-library"><span class="std std-ref">in
the API documentation</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sklearn.linear_model</span>
<span class="kn">import</span> <span class="nn">frankenfit</span> <span class="k">as</span> <span class="nn">ff</span>

<span class="c1"># use &quot;do&quot; as shorthand for a new pipeline</span>
<span class="n">do</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">DataFramePipeline</span><span class="p">()</span>
<span class="n">diamond_model</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">do</span>
    <span class="o">.</span><span class="n">if_fitting</span><span class="p">(</span>
        <span class="c1"># create training response when fitting</span>
        <span class="n">do</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
            <span class="c1"># We&#39;ll train a model on the log-transformed and winsorized price of a</span>
            <span class="c1"># diamond.</span>
            <span class="n">price_train</span><span class="o">=</span><span class="n">do</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">)</span><span class="o">.</span><span class="n">winsorize</span><span class="p">(</span><span class="mf">0.05</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># Transform carats feature to log-carats</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="s2">&quot;carat&quot;</span><span class="p">)</span>
    <span class="c1"># Prepare features: trim outliers and standardize</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">do</span><span class="p">[[</span><span class="s2">&quot;carat&quot;</span><span class="p">,</span> <span class="s2">&quot;depth&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">]]</span>
        <span class="o">.</span><span class="n">suffix</span><span class="p">(</span><span class="s2">&quot;_fea&quot;</span><span class="p">)</span>  <span class="c1"># name the prepared features with _fea suffix</span>
        <span class="o">.</span><span class="n">winsorize</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>  <span class="c1"># trim top and bottom 5% of each</span>
        <span class="o">.</span><span class="n">z_score</span><span class="p">()</span>
        <span class="o">.</span><span class="n">impute_constant</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># fill missing values with zero (since they are z-scores,</span>
                               <span class="c1"># zero is the expected mean)</span>
        <span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># clip z-scores</span>
    <span class="p">)</span>
    <span class="c1"># Fit a linear regression model to predict training response from the prepared</span>
    <span class="c1"># features</span>
    <span class="o">.</span><span class="n">sk_learn</span><span class="p">(</span>
        <span class="n">sklearn</span><span class="o">.</span><span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">,</span>
        <span class="n">x_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;carat_fea&quot;</span><span class="p">,</span> <span class="s2">&quot;depth_fea&quot;</span><span class="p">,</span> <span class="s2">&quot;table_fea&quot;</span><span class="p">],</span>
        <span class="n">response_col</span><span class="o">=</span><span class="s2">&quot;price_train&quot;</span><span class="p">,</span>
        <span class="n">hat_col</span><span class="o">=</span><span class="s2">&quot;price_hat&quot;</span><span class="p">,</span>
        <span class="n">class_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="c1"># Exponentiate the regression model&#39;s predictions back from log-dollars to dollars</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">,</span> <span class="s2">&quot;price_hat&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The pipeline object <code class="docutils literal notranslate"><span class="pre">diamond_model</span></code> is best thought of as a light-weight, abstract, immutable
description of what to do to some as-yet unspecified data; it stores no data or state
in and of itself.</p>
</section>
<section id="fit-pipelines-and-apply-them-to-data">
<span id="synopsis-fit-apply"></span><h2>Fit pipelines and apply them to data<a class="headerlink" href="#fit-pipelines-and-apply-them-to-data" title="Permalink to this headline">#</a></h2>
<p>With our pipeline defined, we <strong>fit</strong> it on the training data, obtaining a
<a class="reference internal" href="api.html#frankenfit.FitTransform" title="frankenfit.FitTransform"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">FitTransform</span></code></span></a> object <code class="docutils literal notranslate"><span class="pre">fit_diamond_model</span></code>, which encapsulates
the learned <strong>states</strong> of all of the transforms in the pipeline:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_diamond_model</span> <span class="o">=</span> <span class="n">diamond_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The fit may then be <strong>applied</strong> to another input <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, in this case the test set:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictions_df</span> <span class="o">=</span> <span class="n">fit_diamond_model</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span>
<span class="n">predictions_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th>carat_fea</th>
      <th>depth_fea</th>
      <th>table_fea</th>
      <th>price_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>0.207014</td>
      <td>Good</td>
      <td>E</td>
      <td>VS1</td>
      <td>56.9</td>
      <td>65.0</td>
      <td>327</td>
      <td>4.05</td>
      <td>4.07</td>
      <td>2.31</td>
      <td>-1.248306</td>
      <td>-2.000000</td>
      <td>1.830680</td>
      <td>724.047740</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.254642</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS2</td>
      <td>62.4</td>
      <td>58.0</td>
      <td>334</td>
      <td>4.20</td>
      <td>4.23</td>
      <td>2.63</td>
      <td>-1.248306</td>
      <td>0.571484</td>
      <td>0.308727</td>
      <td>702.801203</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.270027</td>
      <td>Good</td>
      <td>J</td>
      <td>SI2</td>
      <td>63.3</td>
      <td>58.0</td>
      <td>335</td>
      <td>4.34</td>
      <td>4.35</td>
      <td>2.75</td>
      <td>-1.215013</td>
      <td>1.346166</td>
      <td>0.308727</td>
      <td>707.524695</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.215111</td>
      <td>Very Good</td>
      <td>I</td>
      <td>VVS1</td>
      <td>62.3</td>
      <td>57.0</td>
      <td>336</td>
      <td>3.95</td>
      <td>3.98</td>
      <td>2.47</td>
      <td>-1.248306</td>
      <td>0.485408</td>
      <td>-0.198591</td>
      <td>717.600760</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.207014</td>
      <td>Very Good</td>
      <td>H</td>
      <td>VS1</td>
      <td>59.4</td>
      <td>61.0</td>
      <td>338</td>
      <td>4.00</td>
      <td>4.05</td>
      <td>2.39</td>
      <td>-1.248306</td>
      <td>-2.000000</td>
      <td>1.830680</td>
      <td>724.047740</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can see that the resulting <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="docutils literal notranslate"><span class="pre">predictions_df</span></code>, has a number of new
columns added by our pipline: the standardized features (<code class="docutils literal notranslate"><span class="pre">carat_fea</span></code>, <code class="docutils literal notranslate"><span class="pre">depth_fea</span></code>,
<code class="docutils literal notranslate"><span class="pre">table_fea</span></code>), and most importantly, our predicted price, <code class="docutils literal notranslate"><span class="pre">price_hat</span></code>. We can confirm
that our transforms have affected the distributions in the expected way, and check how
<code class="docutils literal notranslate"><span class="pre">price_hat</span></code> relates to actual <code class="docutils literal notranslate"><span class="pre">price</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">predictions_df</span>
    <span class="p">[[</span><span class="s2">&quot;carat_fea&quot;</span><span class="p">,</span> <span class="s2">&quot;depth_fea&quot;</span><span class="p">,</span> <span class="s2">&quot;table_fea&quot;</span><span class="p">,</span> <span class="s2">&quot;price_hat&quot;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">hist</span><span class="p">()</span>
<span class="p">);</span>

<span class="n">predictions_df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s2">&quot;price_hat&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/synopsis_15_0.png" src="_images/synopsis_15_0.png" />
<img alt="_images/synopsis_15_1.png" src="_images/synopsis_15_1.png" />
</div>
</div>
<p>This is so important:</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Our entire end-to-end model of diamond prices, including feature preparation and
regression, was fit <em>strictly</em> on one set of data (<code class="docutils literal notranslate"><span class="pre">train_df</span></code>) and applied strictly
<strong>out-of-sample</strong> to new data (<code class="docutils literal notranslate"><span class="pre">test_df</span></code>). The columns in <code class="docutils literal notranslate"><span class="pre">test_df</span></code> are being winsorized
using the quantiles that were observed in <code class="docutils literal notranslate"><span class="pre">train_df</span></code>, z-scored using the means and
standard deviations that were observed in <code class="docutils literal notranslate"><span class="pre">train_df</span></code>, and <code class="docutils literal notranslate"><span class="pre">price_hat</span></code> was generated
using the regression betas that were learned on <code class="docutils literal notranslate"><span class="pre">train_df</span></code>.</p>
</div>
<p>The ability to fit a complex pipeline on one set of data and use the fit state to
generate predictions on different data is fundamental to statistical resampling
techniques like cross-validation, as well as many common operations on time series.</p>
<p>Frankenfit provides various transforms that fit and apply <em>child transforms</em>, which can
be combined to achieve many use cases. For example, we can use
<a class="reference internal" href="api.html#frankenfit.dataframe.GroupByCols" title="frankenfit.dataframe.GroupByCols"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">group_by_cols()</span></code></span></a> (together with
<a class="reference internal" href="api.html#frankenfit.dataframe.Correlation" title="frankenfit.dataframe.Correlation"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">correlation()</span></code></span></a>) to check how well our model, which
was fit on the training set, predicts price <em>on the test set</em> for each <code class="docutils literal notranslate"><span class="pre">cut</span></code> of diamond:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">do</span>
    <span class="o">.</span><span class="n">group_by_cols</span><span class="p">(</span><span class="s2">&quot;cut&quot;</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">then</span><span class="p">(</span>
            <span class="n">fit_diamond_model</span>
            <span class="o">.</span><span class="n">then</span><span class="p">()</span>
            <span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="s2">&quot;price_hat&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">)</span>
        <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>price</th>
    </tr>
    <tr>
      <th>cut</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Good</th>
      <th>price_hat</th>
      <td>0.921185</td>
    </tr>
    <tr>
      <th>Premium</th>
      <th>price_hat</th>
      <td>0.927234</td>
    </tr>
    <tr>
      <th>Very Good</th>
      <th>price_hat</th>
      <td>0.928280</td>
    </tr>
    <tr>
      <th>Ideal</th>
      <th>price_hat</th>
      <td>0.928356</td>
    </tr>
    <tr>
      <th>Fair</th>
      <th>price_hat</th>
      <td>0.873844</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>suppose we want to perform 5-fold
cross validation on the model of diamond prices:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crossval_pipeline</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">do</span><span class="o">.</span><span class="n">read_pandas_csv</span><span class="p">(</span><span class="s2">&quot;./diamonds.csv&quot;</span><span class="p">)</span>
    <span class="c1"># randomly assign rows to groups</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">group</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">,</span> <span class="n">ngroups</span><span class="o">=</span><span class="mi">5</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
            <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">ngroups</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">group_by_cols</span><span class="p">(</span>
        <span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="n">fitting_schedule</span><span class="o">=</span><span class="n">ff</span><span class="o">.</span><span class="n">fit_group_on_all_other_groups</span><span class="p">,</span>
    <span class="p">)</span>
        <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">diamond_model</span><span class="p">)</span>  <span class="c1"># &lt;-- our diamond_model pipeline is what&#39;s being grouped!</span>
    <span class="c1"># score the out-of-sample predictions across all groups</span>
    <span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="s2">&quot;price_hat&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">crossval_pipeline</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>price_hat</th>
      <td>0.925855</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We use <code class="docutils literal notranslate"><span class="pre">group_by_cols()</span></code> to divide the dataset into groups (based on a column that we
create with <code class="docutils literal notranslate"><span class="pre">assign()</span></code>), and for each group, generate predictions from the
<code class="docutils literal notranslate"><span class="pre">diamond_model</span></code> pipeline by fitting it on the data from all <em>other</em> groups, but applying
it to the data from the group in question.</p>
<p>This gives us a dataset of entirely out-of-sample predictions, whose performance we
score by feeding it to a transform that outputs the correlation between observed and
predicted price.</p>
</section>
<section id="use-hyperparameters">
<span id="synopsis-hyperparams"></span><h2>Use hyperparameters<a class="headerlink" href="#use-hyperparameters" title="Permalink to this headline">#</a></h2>
<ol class="simple">
<li><p>Hyperparameters and bindings. Concisely describe and execute hyperparameter searches
and data batching.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diamond_model_hyperparams</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">do</span>
    <span class="o">.</span><span class="n">if_fitting</span><span class="p">(</span>
        <span class="n">do</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
            <span class="n">price_train</span><span class="o">=</span><span class="n">do</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">)</span><span class="o">.</span><span class="n">winsorize</span><span class="p">(</span><span class="mf">0.05</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="s2">&quot;carat&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">do</span><span class="p">[</span><span class="n">ff</span><span class="o">.</span><span class="n">HP</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">)]</span>  <span class="c1"># &lt;-- &quot;features&quot; hyperparam</span>
        <span class="o">.</span><span class="n">suffix</span><span class="p">(</span><span class="s2">&quot;_fea&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">winsorize</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="o">.</span><span class="n">z_score</span><span class="p">()</span>
        <span class="o">.</span><span class="n">impute_constant</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">sk_learn</span><span class="p">(</span>
        <span class="n">sklearn</span><span class="o">.</span><span class="n">linear_model</span><span class="o">.</span><span class="n">Lasso</span><span class="p">,</span>
        <span class="c1"># x_cols is a hyperparameterized list of columns derived from &quot;features&quot;</span>
        <span class="n">x_cols</span><span class="o">=</span><span class="n">ff</span><span class="o">.</span><span class="n">HPLambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">bindings</span><span class="p">:</span> <span class="p">[</span><span class="n">f</span><span class="o">+</span><span class="s2">&quot;_fea&quot;</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">bindings</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]]),</span>
        <span class="n">response_col</span><span class="o">=</span><span class="s2">&quot;price_train&quot;</span><span class="p">,</span>
        <span class="n">hat_col</span><span class="o">=</span><span class="s2">&quot;price_hat&quot;</span><span class="p">,</span>
        <span class="n">class_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">ff</span><span class="o">.</span><span class="n">HP</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">),</span>  <span class="c1"># &lt;-- &quot;alpha&quot; hyperparam</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">,</span> <span class="s2">&quot;price_hat&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">diamond_model_hyperparams</span><span class="o">.</span><span class="n">hyperparams</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;alpha&#39;, &#39;features&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">diamond_model_hyperparams</span>
    <span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">then</span><span class="p">()</span>
    <span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="s2">&quot;price_hat&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>price_hat</th>
      <td>0.131313</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>

<span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">]</span>
<span class="n">feature_sets</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;carat&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">,</span> <span class="s2">&quot;carat&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;carat&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="s2">&quot;carat&quot;</span><span class="p">],</span>
<span class="p">]</span>

<span class="n">search_space</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">features</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">feature_sets</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">search_space</span>

<span class="c1">#(</span>
<span class="c1">#    do</span>
<span class="c1">#    .group_by_bindings()</span>
<span class="c1">#)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;alpha&#39;: 0.01, &#39;features&#39;: [&#39;depth&#39;]},
 {&#39;alpha&#39;: 0.01, &#39;features&#39;: [&#39;table&#39;]},
 {&#39;alpha&#39;: 0.01, &#39;features&#39;: [&#39;carat&#39;]},
 {&#39;alpha&#39;: 0.01, &#39;features&#39;: [&#39;depth&#39;, &#39;table&#39;]},
 {&#39;alpha&#39;: 0.01, &#39;features&#39;: [&#39;depth&#39;, &#39;carat&#39;]},
 {&#39;alpha&#39;: 0.01, &#39;features&#39;: [&#39;carat&#39;, &#39;table&#39;]},
 {&#39;alpha&#39;: 0.01, &#39;features&#39;: [&#39;depth&#39;, &#39;table&#39;, &#39;carat&#39;]},
 {&#39;alpha&#39;: 0.05, &#39;features&#39;: [&#39;depth&#39;]},
 {&#39;alpha&#39;: 0.05, &#39;features&#39;: [&#39;table&#39;]},
 {&#39;alpha&#39;: 0.05, &#39;features&#39;: [&#39;carat&#39;]},
 {&#39;alpha&#39;: 0.05, &#39;features&#39;: [&#39;depth&#39;, &#39;table&#39;]},
 {&#39;alpha&#39;: 0.05, &#39;features&#39;: [&#39;depth&#39;, &#39;carat&#39;]},
 {&#39;alpha&#39;: 0.05, &#39;features&#39;: [&#39;carat&#39;, &#39;table&#39;]},
 {&#39;alpha&#39;: 0.05, &#39;features&#39;: [&#39;depth&#39;, &#39;table&#39;, &#39;carat&#39;]},
 {&#39;alpha&#39;: 0.1, &#39;features&#39;: [&#39;depth&#39;]},
 {&#39;alpha&#39;: 0.1, &#39;features&#39;: [&#39;table&#39;]},
 {&#39;alpha&#39;: 0.1, &#39;features&#39;: [&#39;carat&#39;]},
 {&#39;alpha&#39;: 0.1, &#39;features&#39;: [&#39;depth&#39;, &#39;table&#39;]},
 {&#39;alpha&#39;: 0.1, &#39;features&#39;: [&#39;depth&#39;, &#39;carat&#39;]},
 {&#39;alpha&#39;: 0.1, &#39;features&#39;: [&#39;carat&#39;, &#39;table&#39;]},
 {&#39;alpha&#39;: 0.1, &#39;features&#39;: [&#39;depth&#39;, &#39;table&#39;, &#39;carat&#39;]}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">do</span>
    <span class="o">.</span><span class="n">group_by_bindings</span><span class="p">(</span><span class="n">search_space</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">then</span><span class="p">(</span>
            <span class="n">diamond_model_hyperparams</span>
            <span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="s2">&quot;price_hat&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">)</span>
            <span class="c1">#.stateless_lambda(lambda df: df.head(3))</span>
        <span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>price</th>
    </tr>
    <tr>
      <th>features</th>
      <th>alpha</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>['depth']</th>
      <th>0.01</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>['table']</th>
      <th>0.01</th>
      <td>0.128944</td>
    </tr>
    <tr>
      <th>['carat']</th>
      <th>0.01</th>
      <td>0.923514</td>
    </tr>
    <tr>
      <th>['depth', 'table']</th>
      <th>0.01</th>
      <td>0.133433</td>
    </tr>
    <tr>
      <th>['depth', 'carat']</th>
      <th>0.01</th>
      <td>0.923938</td>
    </tr>
    <tr>
      <th>['carat', 'table']</th>
      <th>0.01</th>
      <td>0.923961</td>
    </tr>
    <tr>
      <th>['depth', 'table', 'carat']</th>
      <th>0.01</th>
      <td>0.924758</td>
    </tr>
    <tr>
      <th>['depth']</th>
      <th>0.05</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>['table']</th>
      <th>0.05</th>
      <td>0.130043</td>
    </tr>
    <tr>
      <th>['carat']</th>
      <th>0.05</th>
      <td>0.924911</td>
    </tr>
    <tr>
      <th>['depth', 'table']</th>
      <th>0.05</th>
      <td>0.130043</td>
    </tr>
    <tr>
      <th>['depth', 'carat']</th>
      <th>0.05</th>
      <td>0.924911</td>
    </tr>
    <tr>
      <th>['carat', 'table']</th>
      <th>0.05</th>
      <td>0.924911</td>
    </tr>
    <tr>
      <th>['depth', 'table', 'carat']</th>
      <th>0.05</th>
      <td>0.924911</td>
    </tr>
    <tr>
      <th>['depth']</th>
      <th>0.10</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>['table']</th>
      <th>0.10</th>
      <td>0.131313</td>
    </tr>
    <tr>
      <th>['carat']</th>
      <th>0.10</th>
      <td>0.926361</td>
    </tr>
    <tr>
      <th>['depth', 'table']</th>
      <th>0.10</th>
      <td>0.131313</td>
    </tr>
    <tr>
      <th>['depth', 'carat']</th>
      <th>0.10</th>
      <td>0.926361</td>
    </tr>
    <tr>
      <th>['carat', 'table']</th>
      <th>0.10</th>
      <td>0.926361</td>
    </tr>
    <tr>
      <th>['depth', 'table', 'carat']</th>
      <th>0.10</th>
      <td>0.926361</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_crossval_pipeline</span><span class="p">(</span><span class="n">model_pipeline</span><span class="p">,</span> <span class="n">hat_col</span><span class="p">,</span> <span class="n">response_col</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">do</span><span class="o">.</span><span class="n">read_pandas_csv</span><span class="p">(</span><span class="s2">&quot;./diamonds.csv&quot;</span><span class="p">)</span>
        <span class="c1"># randomly assign rows to groups</span>
        <span class="c1"># ngroups is a hyperparam with default value of 5</span>
        <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
            <span class="n">group</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">,</span> <span class="n">ngroups</span><span class="o">=</span><span class="mi">5</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
                <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">ngroups</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">group_by_cols</span><span class="p">(</span>
            <span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="n">fitting_schedule</span><span class="o">=</span><span class="n">ff</span><span class="o">.</span><span class="n">fit_group_on_all_other_groups</span><span class="p">,</span>
        <span class="p">)</span>
            <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">model_pipeline</span><span class="p">)</span>
        <span class="c1"># score the out-of-sample predictions across all groups</span>
        <span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">hat_col</span><span class="p">,</span> <span class="n">response_col</span><span class="p">)</span>
    <span class="p">)</span>

<span class="n">cv_diamonds_hyperparams</span> <span class="o">=</span> <span class="n">make_crossval_pipeline</span><span class="p">(</span>
    <span class="n">diamond_model_hyperparams</span><span class="p">,</span> <span class="s2">&quot;price_hat&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span>
<span class="p">)</span>
<span class="n">cv_diamonds_hyperparams</span><span class="o">.</span><span class="n">hyperparams</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;alpha&#39;, &#39;features&#39;, &#39;ngroups&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search_cv</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">do</span>
    <span class="o">.</span><span class="n">group_by_bindings</span><span class="p">(</span><span class="n">search_space</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">cv_diamonds_hyperparams</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">search_cv</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ngroups</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>price</th>
    </tr>
    <tr>
      <th>features</th>
      <th>alpha</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>['depth']</th>
      <th>0.01</th>
      <td>-0.003287</td>
    </tr>
    <tr>
      <th>['table']</th>
      <th>0.01</th>
      <td>0.134916</td>
    </tr>
    <tr>
      <th>['carat']</th>
      <th>0.01</th>
      <td>0.924598</td>
    </tr>
    <tr>
      <th>['depth', 'table']</th>
      <th>0.01</th>
      <td>0.137954</td>
    </tr>
    <tr>
      <th>['depth', 'carat']</th>
      <th>0.01</th>
      <td>0.925048</td>
    </tr>
    <tr>
      <th>['carat', 'table']</th>
      <th>0.01</th>
      <td>0.925002</td>
    </tr>
    <tr>
      <th>['depth', 'table', 'carat']</th>
      <th>0.01</th>
      <td>0.925815</td>
    </tr>
    <tr>
      <th>['depth']</th>
      <th>0.05</th>
      <td>0.005841</td>
    </tr>
    <tr>
      <th>['table']</th>
      <th>0.05</th>
      <td>0.135870</td>
    </tr>
    <tr>
      <th>['carat']</th>
      <th>0.05</th>
      <td>0.925936</td>
    </tr>
    <tr>
      <th>['depth', 'table']</th>
      <th>0.05</th>
      <td>0.136029</td>
    </tr>
    <tr>
      <th>['depth', 'carat']</th>
      <th>0.05</th>
      <td>0.925908</td>
    </tr>
    <tr>
      <th>['carat', 'table']</th>
      <th>0.05</th>
      <td>0.925931</td>
    </tr>
    <tr>
      <th>['depth', 'table', 'carat']</th>
      <th>0.05</th>
      <td>0.925938</td>
    </tr>
    <tr>
      <th>['depth']</th>
      <th>0.10</th>
      <td>0.000957</td>
    </tr>
    <tr>
      <th>['table']</th>
      <th>0.10</th>
      <td>0.137113</td>
    </tr>
    <tr>
      <th>['carat']</th>
      <th>0.10</th>
      <td>0.927271</td>
    </tr>
    <tr>
      <th>['depth', 'table']</th>
      <th>0.10</th>
      <td>0.136821</td>
    </tr>
    <tr>
      <th>['depth', 'carat']</th>
      <th>0.10</th>
      <td>0.927314</td>
    </tr>
    <tr>
      <th>['carat', 'table']</th>
      <th>0.10</th>
      <td>0.927259</td>
    </tr>
    <tr>
      <th>['depth', 'table', 'carat']</th>
      <th>0.10</th>
      <td>0.927314</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="run-on-distributed-backends">
<span id="synopsis-backends"></span><h2>Run on distributed backends<a class="headerlink" href="#run-on-distributed-backends" title="Permalink to this headline">#</a></h2>
<ol class="simple">
<li><p>Run on distributed backends, exploiting the parallelism inherent to any branching
operations in the pipeline.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dask</span> <span class="kn">import</span> <span class="n">distributed</span>
<span class="n">cluster</span> <span class="o">=</span> <span class="n">distributed</span><span class="o">.</span><span class="n">LocalCluster</span><span class="p">(</span>
    <span class="n">n_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">threads_per_worker</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">scheduler_port</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">dashboard_address</span><span class="o">=</span><span class="s2">&quot;:0&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">distributed</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dask</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">DaskBackend</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search_cv</span><span class="o">.</span><span class="n">on_backend</span><span class="p">(</span><span class="n">dask</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>price</th>
    </tr>
    <tr>
      <th>features</th>
      <th>alpha</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>['depth']</th>
      <th>0.01</th>
      <td>-0.007899</td>
    </tr>
    <tr>
      <th>['table']</th>
      <th>0.01</th>
      <td>0.134627</td>
    </tr>
    <tr>
      <th>['carat']</th>
      <th>0.01</th>
      <td>0.924591</td>
    </tr>
    <tr>
      <th>['depth', 'table']</th>
      <th>0.01</th>
      <td>0.137360</td>
    </tr>
    <tr>
      <th>['depth', 'carat']</th>
      <th>0.01</th>
      <td>0.925066</td>
    </tr>
    <tr>
      <th>['carat', 'table']</th>
      <th>0.01</th>
      <td>0.925004</td>
    </tr>
    <tr>
      <th>['depth', 'table', 'carat']</th>
      <th>0.01</th>
      <td>0.925805</td>
    </tr>
    <tr>
      <th>['depth']</th>
      <th>0.05</th>
      <td>-0.009893</td>
    </tr>
    <tr>
      <th>['table']</th>
      <th>0.05</th>
      <td>0.135827</td>
    </tr>
    <tr>
      <th>['carat']</th>
      <th>0.05</th>
      <td>0.925939</td>
    </tr>
    <tr>
      <th>['depth', 'table']</th>
      <th>0.05</th>
      <td>0.135710</td>
    </tr>
    <tr>
      <th>['depth', 'carat']</th>
      <th>0.05</th>
      <td>0.925899</td>
    </tr>
    <tr>
      <th>['carat', 'table']</th>
      <th>0.05</th>
      <td>0.925920</td>
    </tr>
    <tr>
      <th>['depth', 'table', 'carat']</th>
      <th>0.05</th>
      <td>0.925926</td>
    </tr>
    <tr>
      <th>['depth']</th>
      <th>0.10</th>
      <td>-0.007318</td>
    </tr>
    <tr>
      <th>['table']</th>
      <th>0.10</th>
      <td>0.136825</td>
    </tr>
    <tr>
      <th>['carat']</th>
      <th>0.10</th>
      <td>0.927263</td>
    </tr>
    <tr>
      <th>['depth', 'table']</th>
      <th>0.10</th>
      <td>0.136844</td>
    </tr>
    <tr>
      <th>['depth', 'carat']</th>
      <th>0.10</th>
      <td>0.927284</td>
    </tr>
    <tr>
      <th>['carat', 'table']</th>
      <th>0.10</th>
      <td>0.927243</td>
    </tr>
    <tr>
      <th>['depth', 'table', 'carat']</th>
      <th>0.10</th>
      <td>0.927278</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if we were doing this for real we&#39;d want to make sure that our group randomization is fixed</span>
</pre></div>
</div>
</div>
</div>
<p>Screenshot of the Dask task-stream:</p>
<p><img alt="task-stream" src="_images/sshot-dask-taskstream-search_cv.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
<span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="transforms_and_pipelines.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Transforms and pipelines</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="install.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Installation and getting started</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Max Bane
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/maxbane/frankenfit" aria-label="GitHub"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16"> <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path> </svg></a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Synopsis and overview</a><ul>
<li><a class="reference internal" href="#create-pipelines">Create pipelines</a></li>
<li><a class="reference internal" href="#fit-pipelines-and-apply-them-to-data">Fit pipelines and apply them to data</a></li>
<li><a class="reference internal" href="#use-hyperparameters">Use hyperparameters</a></li>
<li><a class="reference internal" href="#run-on-distributed-backends">Run on distributed backends</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    </body>
</html>